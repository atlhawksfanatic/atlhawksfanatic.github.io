[
  {
    "objectID": "posts/2019-06-30-how-to-last-two-minutes/index.html",
    "href": "posts/2019-06-30-how-to-last-two-minutes/index.html",
    "title": "How To Extract The Last Two Minute Reports",
    "section": "",
    "text": "The NBA’s Last Two Minute (L2M) reports are intended to be a transparent analysis of referee performance at the end of close NBA games. Having started on March 1st of 2015, they have been publicly available on the official.nba.com section of the NBA’s website. Being publicly available is not the same thing as easily accessible or user friendly. These reports are scattered across their website (with a few games hidden) and in PDF format for the majority of games. The NBA did make a major improvement after the 2019 NBA All-Star game in switching away from PDF format for the reports to a web-based format, however all of the pre-2019 All-Star game L2Ms remain in PDF format.\nThe actual structure of the underlying data in L2Ms is consistent. Each event is a graded action in a play. The action will contain the period of action, time remaining, call (foul, turnover, violation, etc), type of call (shooting foul, personal foul, etc.), committing player, disadvantaged player, decision, and comment of the action. Sometimes there is no disadvantaged or committing player due to the nature of a play, but the intended structure should lend itself to be nicely formatted after all of the information is extracted.\nAll of the code for extracting can be found in my L2M GitHub repository, but this small tutorial is to show how I used R in order to download, parse, and tidy up the L2M data.\n\nDownloading L2Ms\nThere are three main sections of the official.nba.com website where L2Ms reside:\n\nArchived for games from March 1st, 2015 through the 2017 NBA Finals.\n2017-18 for games in the 2017-18 NBA Season.\n2018-19 for games in the 2018-19 NBA Season.\n\nAs a guess, there will likely be a corresponding 2019-20 section of the website where they will put the next season’s games, but as of right now it returns a 404 error.\nDownloading the L2M reports requires the httr and rvest packages as well as the tidyverse for ease of use. But with the 2018-19 season as an example, we can determine all of the urls for the L2Ms by scraping that section of the site and searching for the nodes which contain games:\nlibrary(\"httr\")\nlibrary(\"rvest\")\nlibrary(\"tidyverse\")\n\nurl &lt;- paste0(\"https://official.nba.com/\",\n              \"2018-19-nba-officiating-last-two-minute-reports/\")\n\n# read in url from above, then extract the links that comply with:\nlinks &lt;- read_html(url) %&gt;% \n  html_nodes(\"#main a+ a , strong+ a\") %&gt;%\n  html_attr(\"href\")\n\ntail(links)\n## [1] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-MIL-CHA-10-17-2018.pdf\"  \n## [2] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-BKN-DET-10-17-2018-1.pdf\"\n## [3] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-MIA-ORL-10-17-2018.pdf\"  \n## [4] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-MIN-SAS-10-17-2018.pdf\"  \n## [5] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-DEN-LAC-10-17-2018.pdf\"  \n## [6] \"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-OKC-GSW-10-16-2018.pdf\"\nThe resulting object of urls contains 457 games. Most of these are of PDF format, however as previously mentioned some of these links are web pages and not PDFs:\ntable(tools::file_ext(links))\n## \n##     pdf \n## 170 287\nWe want to separate these two types of links because they require different ways to parse the L2M data for analysis. The PDFs are straight-forward, we simply want to download each of the 287 PDFs into a folder to be parsed later:\n# Create a directory for the data\nlocal_dir     &lt;- \"0-data/L2M/2018-19\"\ndata_source   &lt;- paste0(local_dir, \"/raw\")\nif (!file.exists(local_dir)) dir.create(local_dir, recursive = T)\nif (!file.exists(data_source)) dir.create(data_source, recursive = T)\n\n# Subset only the \nlinks_pdf &lt;- links[grepl(pattern = \"*.pdf\", links)]\n\nfiles  &lt;- paste(data_source, basename(links_pdf), sep = \"/\")\n\n# For each url and file, check to see if it exists then try to download.\n#  need to keep a record of those which fail with a 404 error\n\npdf_games &lt;- map(links_pdf,  function(x) {\n  file_x &lt;- paste(data_source, basename(x), sep = \"/\")\n  if (!file.exists(file_x)) {\n    Sys.sleep(runif(1, 3, 5))\n    tryCatch(download.file(x, file_x, method = \"libcurl\"),\n             warning = function(w) {\n               \"bad\"\n             })\n  } else \"exists\"\n})\nFor the non-PDF links, this becomes a bit more complex. Take for example the last game of the 2018-19 NBA Season’s url: https://official.nba.com/l2m/L2MReport.html?gameId=0041800406\nWe can see that the structure of the L2M is consistent in that each graded action has the required elements of period, time remaining, etc. Ideally, we would want to read the website with read_html() and then simply read in the resulting table with html_table(). This method does not work because the web page is rendered with JavaScript:\nlinks[1] %&gt;% \n  read_html() %&gt;% \n  html_table()\n## [[1]]\n## [1] Period               Time                 Call Type           \n## [4] Committing Player    Disadvantaged Player Review Decision     \n## [7] Video               \n## &lt;0 rows&gt; (or 0-length row.names)\nIn order to correct for this, we need a service which will read in the full page after the JavaScript has been rendered. This is where the splashr package comes in handy as it will allow for the webpage to first load all of the JavaScript (and resulting table of information) that we can then scrape. You will need to have splashr installed and properly set-up, likely with a Docker container running in the background. Once you have this, we can read in the url properly after waiting a few seconds for the web page to render (ie set wait = 7 for a 7 second delay) then read in the resulting html table:\nlibrary(\"splashr\")\n\nsplash_active() # This needs to be TRUE to work...\n## [1] TRUE\nl2m_raw &lt;- render_html(url = links[1], wait = 7)\n\nl2m_site &lt;- l2m_raw  %&gt;% \n  html_table(fill = T) %&gt;% \n  .[[1]]\nglimpse(tail(l2m_site))\n## Observations: 6\n## Variables: 8\n## $ Period                 &lt;chr&gt; \"Period: Q4\", \"Comment:\", \"Period: Q4\", \"…\n## $ Time                   &lt;chr&gt; \"Time: 00:02.1\", \"Leonard (TOR) dives for…\n## $ `Call Type`            &lt;chr&gt; \"Call Type:  Foul: Loose Ball\", \"Leonard …\n## $ `Committing Player`    &lt;chr&gt; \"Committing Player: Kawhi Leonard\", \"Leon…\n## $ `Disadvantaged Player` &lt;chr&gt; \"Disadvantaged Player: Draymond Green\", \"…\n## $ `Review Decision`      &lt;chr&gt; \"Review Decision: CNC\", \"Leonard (TOR) di…\n## $ Video                  &lt;chr&gt; \"Video Url: Video\", \"Leonard (TOR) dives …\n## $ NA                     &lt;lgl&gt; NA, NA, NA, NA, NA, NA\nSuccess! Now with a little bit of tedious adjustments to the resulting data, we can gather up the resulting variables for each action into a consistent format. The gritty details can be found in 0-data/0-L2M-download-2018-19.R.\n\n\nParsing PDFs\nNow back to the PDFs that we stored away for later, although we’ll just use the first one from the 2018-19 Season. We need a package that can extract the text information in each PDF to then extract the relevant variables. The pdftools package allows for the reading of text from each page of a PDF, at which point we will need some understanding of the approximate format of each page:\nlibrary(\"pdftools\")\nraw_text &lt;- pdftools::pdf_text(\"https://ak-static.cms.nba.com/wp-content/uploads/sites/4/2018/10/L2M-OKC-GSW-10-16-2018.pdf\")\nlength(raw_text)\n## [1] 2\nraw_text[[1]]\n## [1] \"Below is the league's assessment of officiated events that occurred in the last two minutes of last night's games that were at or within three points during any point in the last two-minutes of\\nthe fourth quarter (and overtime, where applicable). The plays assessed include all calls (whistles) and notable non-calls. Notable non-calls will generally be defined as material plays directly\\nrelated to the outcome of a possession. Similar to our instant replay standards, there must be clear and conclusive video evidence in order to make a determination that a play was incorrectly\\nofficiated. Events that are indirectly related to the outcome of a possession (e.g., a non-call on contact away from the play) and/or plays that are only observable with the help of a stop-watch,\\nzoom or other technical support, are noted in brackets along with the explanatory comments but are not deemed to be incorrectly officiated. The league may change its view after further\\nreview. If you have any questions, please contact the NBA here.\\n                                                                       Thunder (100) @ Warriors (108) October 16, 2018\\n       Period         Time                          Call Type                              Committing Player                           Disadvantaged Player     Review Decision\\n                   02:03.1                          01:57.7\\n                   02:03.1     To    01:57.7\\n       Q4           01:57.8                      Foul: Personal                                 Kevin Durant                               Steven Adams                  CC\\nComment:            Durant (GSW) dislodges Adams (OKC) from his post position during the pass.\\n                   01:57.7                          01:46.0\\n                   01:57.7     To    01:46.0\\n       Q4           01:49.5                      Foul: Offensive                               Kevon Looney                               Dennis Schroder               CNC\\nComment:            Looney (GSW) establishes a legal picking position in Schröder's (OKC) path before the contact.\\n       Q4           01:46.9                      Foul: Shooting                               Dennis Schroder                               Stephen Curry                CC\\nComment:            Schröder (OKC) trails Curry (GSW) and makes contact with his body during his shooting motion.\\n                   01:46.0                                                     01:27.8\\n                   01:46.0     To    01:27.8\\n       Q4           01:44.0                     Foul: Personal                                Kevin Durant                                 Paul George                  CNC\\nComment:            Durant (GSW) obtains a legal defensive position before George (OKC) initiates contact. The players briefly engage and separate.\\n       Q4           01:37.4                     Foul: Offensive                               Steven Adams                                 Kevin Durant                 CNC\\nComment:            Adams (OKC) is already in Durant's (GSW) path when he and Looney (GSW) move forward slightly. Adams does not deliver or\\n                    extend into Durant's path.\\n       Q4           01:32.1                      Foul: Personal                              Stephen Curry                               Terrance Ferguson              CNC\\nComment:            Curry (GSW) is in a legal guarding position as he moves along Ferguson's (OKC) path during the drive to the basket and any\\n                    contact is incidental.\\n       Q4           01:28.9                      Foul: Shooting                              Draymond Green                               Steven Adams                  CNC\\nComment:            Green (GSW) makes incidental \\\"high-five\\\" contact with Adams (OKC) after the release of his shot attempt in the lane.\\n                   01:27.8                                                           01:06.4\\n                   01:27.8     To    01:06.4\\n       Q4           01:16.0                       Foul: Personal                             Dennis Schroder                               Stephen Curry                CNC\\nComment:            Schröder (OKC) briefly places two hands on Curry (GSW) off ball without affecting his SQBR.\\n       Q4           01:15.4                      Foul: Personal                              Terrance Ferguson                             Kevin Durant                 CNC\\nComment:            LHH shows that Durant (GSW) loses control of the ball on his own, after which Ferguson (OKC) makes contact with the ball and\\n                    makes incidental contact with Durant as they try to retrieve it.\\n       Q4           01:15.4                   Turnover: Traveling                              Kevin Durant                                                             CNC\\nComment:            LHH shows that Ferguson (OKC) makes contact with the ball and Durant (GSW) regains control and continues his dribble.\\n       Q4           01:15.0                     Foul: Offensive                                Kevon Looney                                  Paul George                CNC\\nComment:            Looney (GSW) is in Durant's (GSW) path before the contact on the hand-off. While he is turned, he has already established\\n                    himself in Durant's path and absorbs the contact when it occurs.\\n       Q4           01:07.5                      Foul: Shooting                               Jerami Grant                                  Kevon Looney                CNC\\nComment:            RLS shows that Grant (OKC) obtains a vertical position and absorbs contact from Looney (GSW) on the play at the basket. Since\\n                    the play originates inside the lower defensive box (the area between the 3' posted-up marks, the bottom tip of the circle and the\\n                    endline), Grant can be on the floor in the restricted area when the contact occurs.\\n                                                                                                                                                                                          1\\n\"\nEach L2M has the same type of disclaimer and description at the beginning. It is always something to the effect of explaining that they grade calls although the literal description does change. This is not important to us, what we firstly need to find in the text is where the game details occur for each page. The game details are where the two teams are mentioned and the date. For this report, it is “Thunder (100) @ Warriors (108) October 16, 2018” that starts the relevant information. At the other end of the spectrum, we need to find out where the page ends. This particular L2M has two pages and the second page ends with a description of “Event Assessments” while the first page simply ends with a “1” to indicate it is the first page. So if “Event Assessments” is not present on the page, we know it will end with a page number. We want to find the beginning and end of the relevant information of each line and only keep those lines:\ntemp &lt;- raw_text[[1]] %&gt;% \n  str_split(\"\\n\") %&gt;% \n  unlist() %&gt;% \n  str_trim()\n\n# Each report will start off with the two teams and an @ symbol\n#  I don't think there's any other @s in a pdf\nbegin &lt;- grep(\"@\", temp)\n# in case of another \"@\" instance just take the first\nif (length(begin) &gt; 1) {\n  begin &lt;- begin[1]\n  game_details = temp[begin]\n  } else if (length(begin) == 1) {\n    game_details = temp[begin]\n    # But if it doesn't exist, then it's a secondary page so set to 1\n    } else if (length(begin) == 0) { \n      begin = 1\n      game_details = NA\n    }\n\n# Each report finishes with a footer that describes the event assessments\ndone  &lt;- grep(\"Event Assessments\", temp)\n# But there might not be any pages where this ends\nif (length(done) == 0) {\n  done = length(temp) + 1\n  }\n\ntemp_info &lt;- temp[(begin):(done - 1)]\nhead(temp_info)\n## [1] \"Thunder (100) @ Warriors (108) October 16, 2018\"                                                                                                                         \n## [2] \"Period         Time                          Call Type                              Committing Player                           Disadvantaged Player     Review Decision\"\n## [3] \"02:03.1                          01:57.7\"                                                                                                                                \n## [4] \"02:03.1     To    01:57.7\"                                                                                                                                               \n## [5] \"Q4           01:57.8                      Foul: Personal                                 Kevin Durant                               Steven Adams                  CC\"    \n## [6] \"Comment:            Durant (GSW) dislodges Adams (OKC) from his post position during the pass.\"\nWe now have each line after the beginning read in. At this point, we need to determine which lines contain information about a play. Each play begins with a period and then time. We need to find each line with a mention of a period and subset that information to be read in as a play:\n# Does the line contain a quarter reference? Then it's probably a play\nplays &lt;- temp_info[c(grep(\"^Period\", temp_info),\n                     grep(\"^Q\", temp_info))]\n\nplay_data &lt;- read_table(plays, col_names = FALSE,\n                        col_types = cols(.default = \"c\"))\n\nglimpse(play_data)\n## Observations: 13\n## Variables: 7\n## $ X1 &lt;chr&gt; \"Period\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4…\n## $ X2 &lt;chr&gt; \"Time\", \"01:57.8\", \"01:49.5\", \"01:46.9\", \"01:44.0\", \"01:37.4\"…\n## $ X3 &lt;chr&gt; \"Call Type\", \"Foul: Personal\", \"Foul: Offensive\", \"Foul: Shoo…\n## $ X4 &lt;chr&gt; \"Committing Player\", \"Kevin Durant\", \"Kevon Looney\", \"Dennis …\n## $ X5 &lt;chr&gt; \"Disadvantaged Player\", \"Steven Adams\", \"Dennis Schroder\", \"S…\n## $ X6 &lt;chr&gt; \"Review\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"\n## $ X7 &lt;chr&gt; \"Decision\", \"CC\", \"CNC\", \"CC\", \"CNC\", \"CNC\", \"CNC\", \"CNC\", \"C…\nWe are fortunate for this particular PDF that there are only 7 columns of data because the adjustment for the resulting data.frame is to simply rename the columns and combine the last two columns:\nnames(play_data) &lt;- c(\"period\", \"time\", \"call_type\", \"committing\",\n                      \"disadvantaged\", \"decision\", \"decision2\")\nplay_data &lt;- play_data %&gt;% \n  mutate(decision = ifelse(is.na(decision) | decision == \"\",\n                           decision2, decision)) %&gt;% \n  select(period, time, call_type, committing, disadvantaged, decision)\nglimpse(play_data)\n## Observations: 13\n## Variables: 6\n## $ period        &lt;chr&gt; \"Period\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\"…\n## $ time          &lt;chr&gt; \"Time\", \"01:57.8\", \"01:49.5\", \"01:46.9\", \"01:44.0\"…\n## $ call_type     &lt;chr&gt; \"Call Type\", \"Foul: Personal\", \"Foul: Offensive\", …\n## $ committing    &lt;chr&gt; \"Committing Player\", \"Kevin Durant\", \"Kevon Looney…\n## $ disadvantaged &lt;chr&gt; \"Disadvantaged Player\", \"Steven Adams\", \"Dennis Sc…\n## $ decision      &lt;chr&gt; \"Review\", \"CC\", \"CNC\", \"CC\", \"CNC\", \"CNC\", \"CNC\", …\nThe only thing missing for the data now are the comments. In the PDFs, comments are below the play action and thus we need to extract each of these lines individually then add them as a separate column to the play_data:\ntemp_com &lt;- str_remove(temp_info[grep(\"^Comment\", temp_info)], \"Comment:\")\ncomment  &lt;- data.frame(comments = str_trim(temp_com))\n# add in an NA comment to account for the header\ncomments &lt;- bind_rows(data.frame(comments = NA), comment)\n\nresults &lt;- bind_cols(play_data, comments)\nglimpse(results)\n## Observations: 13\n## Variables: 7\n## $ period        &lt;chr&gt; \"Period\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\", \"Q4\"…\n## $ time          &lt;chr&gt; \"Time\", \"01:57.8\", \"01:49.5\", \"01:46.9\", \"01:44.0\"…\n## $ call_type     &lt;chr&gt; \"Call Type\", \"Foul: Personal\", \"Foul: Offensive\", …\n## $ committing    &lt;chr&gt; \"Committing Player\", \"Kevin Durant\", \"Kevon Looney…\n## $ disadvantaged &lt;chr&gt; \"Disadvantaged Player\", \"Steven Adams\", \"Dennis Sc…\n## $ decision      &lt;chr&gt; \"Review\", \"CC\", \"CNC\", \"CC\", \"CNC\", \"CNC\", \"CNC\", …\n## $ comments      &lt;fct&gt; NA, \"Durant (GSW) dislodges Adams (OKC) from his p…\nWe now have enough comments to match he play data and have completed extracting the relevant information from a page in a PDF. This was a relatively straight-forward page and how one would hope the PDFs are all structured. Unfortunately, not all pages in PDfs are this simple and you can see all the gory hacks that have needed to parse through all of the PDFs for just the 2018-19 NBA Season in the 0-data/0-L2M-pdftools-2018-19.R file."
  },
  {
    "objectID": "posts/2018-03-10-nba-financials-2016-17/index.html",
    "href": "posts/2018-03-10-nba-financials-2016-17/index.html",
    "title": "Backing Out 2016-17 NBA Financials",
    "section": "",
    "text": "As I was casually looking through and viewing the panels and videos of the Sloan Sports Analytics Conference the other weekend, I realized a common theme for the 2018 Conference to the previous ones. For the NBA, there were plenty of applications of analytics1 to player evaluations, injuries, in-game strategies, and ticket pricing. All of these topics were present in 2018 as they have been throughout the conference’s lifetime. However, there was only limited discussion of the NBA’s Salary Cap and any analytical applications applied to the Salary Cap was non-existent.1 I use the term analytics liberally here as there were panelists invoking “the eye test” in their discussions. Why has this become a phrase? It’s just someone talking out of their ass.\nPanelists certainly know about the Salary Cap as this was brought up in at least 2 panels. Steve Ballmer made comments on his front office’s analytics at around the 31 minute mark. He had an interesting tidbit on the Salary Cap where he effectively thinks of it in a game theoretic context:\n\nOne actually that has become most interesting to me is salary cap planning. It’s most fundamental to the product. It’s not as statistical and involved but it’s like a big chess game: Where do you want to have powder? How do you use the powder? Will you be successful at taking the risks that you want to take? I find it a very interesting numeric chess game, if you will, and there are teams that absolutely do it better and do it worse. I see Darrell sitting in the front row, we made a trade: Chris Paul for a number of guys back for Houston. I thought they did something very clever in having a whole set of non-guaranteed contracts that really gave him more flexibility in putting the deal together with us than they would have had otherwise. But that is kind of numeric, strategic chess game like planning that I think is an important part of let me call it the numeric exercise as opposed to what people think about is classic analytics.\n\nAnd in the penultimate presentation, Sam Hinkie also touched on the Salary Cap at around the 20 minute mark through about the 23 minute mark with the same analogy of treating cap space like powder2 but offered little insight beyond how to utilize the cap space. Neither of these panels discussed the possibility of using analytics to better predict the Salary Cap. It is hard to determine if this is because no one is engaged in this form of analytics or if they simply do not want to tip their hand and give others an edge on this topic.2 When I hear people use the same analogy to describe a topic, I assume this is because the people learned the topic in the same manner – ie had the same teacher or read the same book.\nWhatever the reason is, it dawned on me that I have yet to see anyone publish key components to the Salary Cap from the 2016-17 NBA Season. Larry Coon used to keep track of certain financial values in his CBAFAQ for the 2011 CBA, but has yet to do so for the 2017 CBA. Albert Nahmad over at HeatHoops.com has also tracked financial components for the NBA and even discussed the NBA’s 2016-17 Salary Cap projections last year. But Albert’s last update for NBA financials was in June of 2017 a few weeks before the Salary Cap was officially set.\nLet me provide some of the important figures for the NBA’s finances in the 2016-17 Season. However, I will not just give the values but I will provide a description for how I came to these values as a way to “show my work” and as an educational exercise for others interested in the Salary Cap.\n\n\nRevenues Side\nLet’s start with what we know: the NBA set the Salary Cap for 2017-18 Season at $99,093,000 and the Luxury Tax at $119,266,000. That allows us to know pretty close to what the BRI for 2016-17 is and lets us know exactly what Projected BRI is. To get to these values, we need to define how the Salary Cap is set:\n\\[\nSC_t = \\frac{0.4474*\\text{Projected BRI}_t - \\text{Projected Benefits}_t}{\\text{# of teams (30)}} + \\frac{\\text{Adjustment}_t}{\\text{# of teams (30)}}\n\\]\nWhere I will eventually get to defining what goes into Projected BRI, Projected Benefits, and Adjustment throughout this article. As of right now, all three of those components are unknown to us but can and will be determined. The Luxury Tax is set in the same fashion, except the factor multiplied by Projected BRI is 53.51% instead of 44.74%:\n\\[\nLC_t = \\frac{0.5351*\\text{Projected BRI}_t - \\text{Projected Benefits}_t}{\\text{# of teams (30)}} + \\frac{\\text{Adjustment}_t}{\\text{# of teams (30)}}\n\\]\nThis leaves us with 2 equations and 3 unknowns: Projected BRI, Projected Benefits, and the Adjustment. We can subtract the Salary Cap from the Luxury Tax and do some algebra to redefine Projected BRI as:\n\\[\n\\text{Projected BRI}_t = \\frac{\\text{# of teams (30)}}{(0.5351 - 0.4474)}*(LT_t - SC_t) = \\frac{\\text{# of teams (30)}}{(0.0877)}*(LT_t - SC_t)\n\\]\nWe have eliminated one equation and two of the unknowns. Now we are left with one equation and one unknown which becomes a plug-n-chug to figure out that the Projected BRI used in the 2017-18 Salary Cap calculation is $6,900,684,151. We can use Projected BRI as well as the NBA’s TV contract to back out what actual BRI was for 2016-17. This comes from the definition of Projected BRI in the CBA VII 7.2.c where the known value of the National TV payout for the year of interest is added to 1.045 times the non-TV portion of BRI for the previous year. Or in other words, BRI is split into the TV and non-TV portion for every year. The TV portion is known in advance due to the nature of the contract having a specific yearly payout. However, the non-TV portion of BRI covers revenue sources that are variable and not well known for the future. Because of the variable nature, the NBA will simply project forward a 4.5% increase in this amount for the Projected BRI:\n\\[\n\\\\ \\text{Projected BRI}_t = TV_t + 1.045*\\text{non-TV BRI}_{t-1}\n\\\\ \\text{Projected BRI}_t = TV_t + 1.045*({BRI}_{t-1} - {TV}_{t-1})\n\\]\nAnd doing a bit more arithmetic gymnastics, we can write BRI as a function of Projected BRI and TV revenues:\n\\[\n{BRI}_{t-1} = \\frac{\\text{Projected BRI}_t - TV_t}{1.045} + {TV}_{t-1}\n\\]\nOr in other words, the 2016-17 BRI is a function of the Projected BRI in 2017-18 and the TV values of 2017-18 and 2016-17. We know projected BRI here, thus to get BRI in 2016-17 we need to inject what the National TV deal values are. Larry Coon reported a value of $2.1 billion for the 2016-17 season in an insiders article that was confirmed by Zach Lowe. I took a educated guess of the 2017-18 value as $2.225 billion based on Zach Lowe’s description of the payouts for the national TV contract. Plugging these values in gives us an estimate of BRI for 2016-17 of $6,574,338,900.\nThat’s what we’re going with for 2016-17 BRI: $6,574,338,900 with $2.1 billion representing the TV contract and $4,474,338,900 in non-TV BRI. But keep in mind, this is an educated guess because we don’t know exactly what the national TV deal values are. If we did, then we’d have complete certainty on this value.\n\n\nCosts Side\nAt this point, we have a good guess at how the revenues in 2016-17 went for the NBA. We need to go into the cost side of things to get a full picture for the trends in the NBA Salary Cap. Since we already know Projected BRI for 2017-18, we can actually back out what the Projected Benefits less the Adjustment (also known as the shortfall) were. Doing some plug-n-chug from the Salary Cap equation gives us a value of $114,576,089 for Projected Benefits less the Adjustment for 2017-18. We’ll get to how the adjustment is calculated in a second.\nProjected Benefits are defined within the CBA IV-9 and are effectively an increase of 4.5% from the previous year’s Benefits plus an additional amount equal to 1% of Projected BRI. The previous year’s Benefits for this calculation exclude the 1% of BRI which gets added on and I term this Residual Benefits – which are Benefits less 1% of the BRI for that year. This can be summarized as follows:\n\\[\n\\text{Projected Benefits}_t = 0.01*\\text{Projected BRI}_t + 1.045*\\text{Residual Benefits}_{t-1}\n\\]\nAlthough another way to define Projected Benefits would be:\n\\[\n\\text{Projected Benefits}_t = 0.01*\\text{Projected BRI}_t + 1.045*(\\text{Benefits}_{t-1} - 0.01*{BRI}_{t-1})\n\\]\nIn trying to back out the Projected Benefits used for the 2017-18 Salary Cap, we need to know Projected BRI of 2017-18 (got it), Benefits in 2016-17 (missing), and BRI in 2016-17 (got it). Almost there! We have two unknowns in this equation. Even though we know that Projected Benefits less Adjustment is $114,576,089 we don’t know the Adjustment. We’re going to have to go about this a different way.\nIn the 2015-16 season, the value of Benefits less the Adjustment ended up being $105,593,330. Per Larry Coon, the players received a total amount of Salaries and Benefits of $2,558,000,000 and of that amount, $2,346,000,000 was Salaries and $212,000,000 was Benefits. The players were short-changed $130.5 million in their Guaranteed BRI amount – ie the shortfall – as the players were guaranteed to receive $2,688,495,000 (50.83% of BRI) and yet their total Salaries and Benefits only made up $2,558,000,000. The $130.5 million shortfall was added onto the Salary Cap for the 2016-17 Season which increased the Salary Cap by $4.35 million.\nFor the 2016-17 Season, we know that the BRI was $6,574,338,900 and the Forecasted BRI was $5,089,000,000. The players are guaranteed between 49% and 51% of BRI where the difference is a result of the actual BRI and Forecasted BRI. For each dollar over (or under) the Forecasted BRI, 60.5% is added (subtracted) to the guaranteed share. Per CBAFAQ:\n\nCollectively, the players are guaranteed to receive 50% of forecasted revenues, plus (or minus) 60.5% of the amount by which revenues exceed (or fall short of) the forecasts, with a lower limit of 49% of BRI and an upper limit of 51% of BRI.\n\nForecasted BRI in 2016-17 was $5.089 billion – the 50% limit was $2.5445 billion. We already determined that the BRI in 2016-17 was $6.574 billion. Actual BRI exceeded Forecasted BRI by $1,485,338,900. The 60.5% amount of the excess would be $898,630,035 to be added onto the guaranteed percentage to give a total of $3,443,130,035 in Guaranteed BRI. Except this amount exceeds the 51% limit. The players were guaranteed a total of $3,352,912,839 in Salaries and Benefits for the 2016-17 Season.\nNow we have another equation we can introduce in order to get to Projected Benefits and the Adjustment. When the NBA fails to pay out collectively in Salaries and Benefits the guaranteed amount, a check is cut to the NBPA for the Adjustment amount and the Adjustment (divided by the number of teams) is then added onto the Salary Cap and Luxury Tax. Using this knowledge, we know that this relationship must hold:\n\\[\n\\text{Guaranteed BRI}_t = \\text{Adjustment}_t + \\text{Salaries}_t + \\text{Benefits}_t\n\\]\nWe just figured out the Guaranteed BRI amount but still don’t know what the Actual Benefits and Adjustment are. But we can estimate the Salaries paid out for the 2016-17 Season were to put this together.\nSpotrac’s value3 of money spent for the 2016-17 Season was $2,962,716,058. In comparison, his 2015-16 value was $2,374,265,169 and Larry Coon reported $2.346 billion in his CBAFAQ. That’s good enough for government work.3 While I do not condone listing Spotrac as a primary source, they actually do a good job of compiling salary data. Spotrac gathers their data from some combination of Mark Deeks, Bobby Marks, and Eric Pincus.\nWe know Guaranteed BRI less Salaries (per Spotrac) in 2016-17 is $390,196,781. That’s another way of saying that Benefits plus Adjustment is $390,196,781. Now we can go way back to a relationship of:\n\\[\n\\text{Projected Benefits}_t = 0.01*\\text{Projected BRI}_t + 1.045*(\\text{Benefits}_{t-1} - 0.01*BRI_{t-1})\n\\]\nNow we subtract the Adjustment from each side and realize we already figured out that the Projected Benefits less Adjustment is equal to $114,576,089:\n\\[\n\\$114,576,089 = 0.01*\\text{Projected BRI}_{2017} + 1.045*(\\text{Benefits}_{2016} - 0.01*{BRI}_{2016}) - {Adjustment}_{2017}\n\\]\nGoing to start adding in some more values, but also keep in mind that $6,900,684,151 is our Projected BRI amount:\n\\[\n\\\\ \\$114,576,089 = \\$69,006,842 + 1.045*({Benefits}_{2016} - \\$52,890,000) - {Adjustment}_{2017}\n\\\\ \\$114,576,089 = \\$69,006,842 - \\$55,270,050 + 1.045*{Benefits}_{2016} - {Adjustment}_{2017}\n\\\\ \\$100,839,297 = 1.045*{Benefits}_{2016} - {Adjustment}_{2017}\n\\]\nPer the Larry Coon values, the Benefits in the 2015-16 Season were $212,000,000, which will give us:\n\\[\n{Adjustment}_{2017} = 1.045*{Benefits}_{2016} - \\$100,839,297 = \\$221,540,000 - \\$100,839,297\n\\]\nGiving us an adjustment value of $120,700,703. Which implies that the NBA Salary Cap was increased by approximately $4 million due to not paying the players enough in the form of Salaries and Benefits.\nOur last bit of arithmetic is then to back out the Benefits for the 2016-17 Season based on our derived value of the Adjustment. This gives us $269,496,078 in Benefits paid out by the NBA."
  },
  {
    "objectID": "posts/2017-04-30-welcome/index.html",
    "href": "posts/2017-04-30-welcome/index.html",
    "title": "Welcome",
    "section": "",
    "text": "This site is meant to host various information related to the NBA’s Collective Bargaining Agreement (CBA), its Last 2 Minute Reports (L2M), the economics of the NBA, and possibly the Atlanta Hawks. If you are looking for opinionated content, then you will be disappointed by this site. My goal is to explain issues within the NBA, disperse information, and provide insight that may not be available elsewhere. Hopefully, you can gain a bit of knowledge from some aspect of this site.\nThis is the second iteration of the website, although you aren’t missing much from the first as everything is reproduced here. I’ve even kept the original publish date for this portion blog post (2017-04-30) even though it’s nearly 6 years later. It is still a tad unclear as to what information will populate this site and how it will be structured. But this will certainly be a website.\nEnjoy."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This site’s purpose is to provide various information related to the NBA’s Collective Bargaining Agreement (CBA), its Last 2 Minute Reports (L2M), the economics of the NBA, and possibly the Atlanta Hawks. If you are looking for opinionated content or hot takes, then you will be disappointed by this site. My goal is to explain issues within the NBA, disperse information, and provide insight that may not be available elsewhere. Hopefully, you can gain a bit of knowledge from some aspect of this site.\nFor those curious about the “fanatic” portion of the atlhawksfanatic moniker: It comes from an old program I used to participate in during the early 2000s for Atlanta Hawks home games. The program was first called the Fanatical Fans Section but it eventually morphed into the Hawk-a-Licious Fan Section and then, poof….gone before the end of the 2004-05 NBA season and never spoken of by the organization again.\nThe organization created a similar program that they titled the 6th Man Section around 2011. But the original group was called the Fanatical Fans.\nAnd that is where the the name comes from. It’s not a reference from how intense of a fan of the organization I am/was but an homage to being a fan during quite possibly the worst time to be an Atlanta Hawks fan.\n\n\n\nShirt from Fanatical Fan Section"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "hello there.",
    "section": "",
    "text": "This site’s purpose is to provide various information related to the NBA’s Collective Bargaining Agreement (CBA), its Last 2 Minute Reports (L2M), the economics of the NBA, and possibly the Atlanta Hawks. If you are looking for opinionated content or hot takes, then you will be disappointed by this site. My goal is to explain issues within the NBA, disperse information, and provide insight that may not be available elsewhere. Hopefully, you can gain a bit of knowledge from some aspect of this site.\nThis is the second iteration of the website, although you aren’t missing much from the first as everything is reproduced here. It is still a tad unclear as to what information will populate this site and how it will be structured. But this will certainly be a website.\nEnjoy.\n\n\n\n\n\n\n\n\n  \n\n\n\n\nHow To Extract The Last Two Minute Reports\n\n\n\n\n\n\n\n\n\n\n\n\nJun 30, 2019\n\n\nRobert\n\n\n\n\n\n\n  \n\n\n\n\nUpdating The Last Two Minute Reports\n\n\n\n\n\n\n\n\n\n\n\n\nJun 23, 2019\n\n\nRobert\n\n\n\n\n\n\n  \n\n\n\n\nBacking Out 2016-17 NBA Financials\n\n\n\n\n\n\n\n\n\n\n\n\nMar 10, 2018\n\n\nrobert\n\n\n\n\n\n\n  \n\n\n\n\nCBA About\n\n\n\n\n\n\n\n\n\n\n\n\nMay 4, 2017\n\n\nrobert\n\n\n\n\n\n\n  \n\n\n\n\nWelcome\n\n\n\n\n\n\n\n\n\n\n\n\nApr 30, 2017\n\n\nrobert\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/2017-05-04-cba-about/index.html",
    "href": "posts/2017-05-04-cba-about/index.html",
    "title": "CBA About",
    "section": "",
    "text": "If you’re interested in reading the NBA’s Collective Bargaining Agreement (CBA), then go to here immediately. If not, continue reading.\nThe NBA’s CBA is a 598 page legal document that details the labor practices between the NBA and its players. Not only is it a lengthy document, but one that is complicated by an immense amount of self-referencing. Almost every portion of the document references some other section, which can get fairly complex if you cannot remember what the referenced section pertains to.\nIts structure is supposed to follow a syntax,1 but it turns out that it this is not consistent. The obvious culprits are Microsoft Word and whoever wrote up the relevant sections in the incorrect version of Word. This ends up leading to typos within the document when they attempt to reference sections which have inconsistent numbering.1 An article is referenced as a roman numeral and is the starting point of each relevant topic. Next, is a section which is numerically ordered (1, 2, 3, …) and is a subtopic within each article that goes in alphabetical order (a, b, c, … aa, bb, cc, …). But this is where the structure becomes muddied. For most parts of the CBA, the 3rd section under the article is ordered through a lower case roman numeral fashion (i, ii, iii, iv, …). This is not at all consistent as the first diversion from this structure is in Article 4, Section 1, (a) Benefits. The ordering is then in numeric order (1, 2, 3…). This is subsequently violated many times.\n\nRegardless of this problem, the pdf which the NBPA provides is inadequate. One cannot easily flip through the document because there are no bookmarks or structure.\nThis pissed me off.\nSo I decided to use bookdown to recreate the CBA as-is. I maintain all of the text within the CBA but break apart the document by article and section. Any reference within the CBA (and its possible typo) is maintained.\nThe main output is an html output at atlhawksfanatic.github.io/NBA-CBA/ and has an unfortunate glitch that articles are numeric instead of roman numerals. But aside from that, the website contains a search feature at the top as to make it easier to find a particular topic within the CBA. I know that’s been useful to me lately.\n\nBeyond this, the website does contain a pdf and epub version of the CBA. They are slightly hidden in the webpage. If you look at the top, there’s a download icon that you can click. Once you do that, then you can download either formats. And both of those formats maintain the roman numeral structure to articles if that matters to you. It’s the document right above here, so check it out. I hope it doesn’t disappoint.\nI hope this resource is helpful to people."
  },
  {
    "objectID": "posts/2019-06-23-last-two-minutes-update-2019/index.html",
    "href": "posts/2019-06-23-last-two-minutes-update-2019/index.html",
    "title": "Updating The Last Two Minute Reports",
    "section": "",
    "text": "Since the NBA began their Last Two Minute Reports (L2M) on 2015-03-01, there have been 1,934 games which have received referee grades for at least their last two minutes of NBA action. While the general public may not understand the purpose of the L2Ms, the NBA provides a FAQ for why L2Ms exist:\nWhile these justifications appear fairly straight-forward, the actual L2M process has not been fully transparent. In fact, when I first analyzed the L2Ms on Peachtree Hoops in February of 2017 it was apparent that there were changes in the criteria for grading plays. Aside from how particular plays were graded, the process of deciding whether or not a game would be publicly released as a L2M were altered with little notice.\nThe NBA changed the criteria at the start of the 2017-18 NBA Season to publicly release “any game in which one team’s lead over the other is three points or fewer at any point during the last two minutes of the fourth quarter or overtime.” Prior to 2017-18 NBA Season, the score difference at the two minute mark of the fourth quarter needed to be five points or fewer to be included – although if a game subsequently went into overtime then a L2M would be publicly released. And there was once a time when the NBA would grade all five minutes of an overtime, although the last time this occurred was on 2016-05-09 and has yet to happen since. There has been no public statement from the NBA as to why the overtime periods only include the last two minutes of said period, it just happened and hardly anyone noticed.\nI am here to update my previous analysis with the added data for the 2017-18 and 2018-19 NBA Seasons with a data friendly format (comma separated values). There is another publicly available version of the L2M data in an analyst friendly format from the folks at The Pudding, however they stopped updating their data after the 2018 NBA Finals. At the bottom of this (and here), you can find my version of the data through the most recent 2019 NBA Finals and code to reproduce it. Consider this some public service.\nBut let’s dig in to see how the L2Ms have continued to change over time by first going through a refresher for how the games are graded."
  },
  {
    "objectID": "posts/2019-06-23-last-two-minutes-update-2019/index.html#correct-non-calls",
    "href": "posts/2019-06-23-last-two-minutes-update-2019/index.html#correct-non-calls",
    "title": "Updating The Last Two Minute Reports",
    "section": "Correct Non-Calls",
    "text": "Correct Non-Calls\nThe CNC category is not straight-forward and has the possibility to influence metrics about how “correct” an official may be. Any serious data analysis of referee performance should ignore this category as it’s not clear what the criteria is to be a CNC and if this criteria has varied over time.\nFor each action, there are a large number of CNC available. Just think for a moment, as long as none of the 10 players on the court are in the paint for more than 3 consecutive seconds there are 10 potential CNC actions on a play. For each legal dribble, there is an available CNC action that no palming, travel, or double dribble occurred. The infinite possibilities of CNC action aside, a CNC does not clearly denote that a referee observed this particular action and consciously decided it was a legal action because the very nature of a CNC is passive inaction. I am not saying that the NBA L2Ms are nefarious in their CNC grades (more on that later), but the very concept of a CNC is so loony that it should not be taken seriously.\nThat bit of a rant aside, we can look at the number of graded actions for L2Ms by decisions. In the following chart, I have coded the blank decisions as “inc” but also taken the liberty to be practical and combine the blank decisions with the INC for the “INC (implied)” category. As you can see, the overwhelming amount of action in the reports is CNC and this category has crept up each season:\n\n\n\nplot of chunk grade-calls\n\n\nThe implications of an increased CNC count? Well that is clear, if one wanted to see how often a referee was “correct” then a naive metric would be to construct a version of correct plays divided by total plays – \\( \\) where one should include the blank calls into the INC but maybe they do not. Let’s call this Naive Accuracy and if one does that, then clearly it looks like the NBA referees have been improving in accuracy over time:\n\nL2M CNC Effects\n\n\n\n\n\n\n\n\n\nSeason\nGames\nGrades per period\nNaive Accuracy (without blanks)\nNaive Accuracy (including blanks)\n\n\n\n\n2015\n139\n11.3\n87.0%\n86.5%\n\n\n2016\n439\n12.9\n88.5%\n85.5%\n\n\n2017\n428\n15.0\n91.4%\n82.8%\n\n\n2018\n475\n19.7\n93.8%\n86.9%\n\n\n2019\n453\n21.3\n93.2%\n87.4%\n\n\n\nEyeballing these estimates, the Naive Accuracy without blanks could be roughly thought of as around 90% with a very clear upward trend. There is less of a pronounced trend when including the blank category and it is consistently below 90%. The claim of 90% accuracy is important to note because in the NBA’s FAQ for L2M it states “NBA officials are correct roughly 90 percent of the time” as you can see at the beginning of this article.\nWhy should 90% matter? I have no idea aside from that being thought of as the standard threshold for an “A” in academic work. But it is also possible Campbell’s Law is at work and the NBA has already decided their level of success for referees should be 90% and they are striving to achieve it with their reports. Frankly, I do not know the reason nor do I think anyone should care because this is a poorly constructed measure for evaluating referees.\nBut to be clear, the large-scale increase in CNC certainly has an effect of improving the Naive Accuracy measures but that does not imply nefarious activity of CNC. If any cooking of the books existed, then we should see L2M reports with IC or INC calls in them to have more CNC calls as a way to target the 90% threshold. We can break apart the L2Ms by this criteria for each season to see if there are systematically more CNC with reports of a bad call than without, it turns out there is not much evidence this occurs:\n\nCNC Count Conditional on IC in Report\n\n\n\n\n\n\n\n\nSeason\nIC Occurred\nNo IC Occurred\nShare of Games With IC\n\n\n\n\n2015\n3.61\n5.46\n18.0%\n\n\n2016\n6.43\n6.45\n22.3%\n\n\n2017\n8.36\n8.36\n8.18%\n\n\n2018\n12.61\n13.14\n12.6%\n\n\n2019\n14.99\n15.15\n14.3%\n\n\n\n\nCNC Count Conditional on INC in Report\n\n\n\n\n\n\n\n\nSeason\nINC Occurred\nNo INC Occurred\nShare of Games With INC\n\n\n\n\n2015\n5.29\n4.38\n73.4%\n\n\n2016\n6.69\n5.45\n77.0%\n\n\n2017\n8.42\n7.22\n93.7%\n\n\n2018\n12.99\n14.11\n92.0%\n\n\n2019\n15.08\n15.83\n93.8%\n\n\n\nWhat is clear is that there are more CNC calls in each season, regardless of whether or not a bad call happened."
  }
]